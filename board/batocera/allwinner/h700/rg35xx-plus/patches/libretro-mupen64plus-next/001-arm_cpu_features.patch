From 0ed7144fd505849b6d9920cf138532c1921bf51b Mon Sep 17 00:00:00 2001
From: Philippe Simons <simons.philippe@gmail.com>
Date: Sat, 23 Mar 2024 17:24:23 +0100
Subject: [PATCH] Update arm_cpu_features.c

---
 .../r4300/new_dynarec/arm/arm_cpu_features.c  | 31 +++++++++----------
 1 file changed, 14 insertions(+), 17 deletions(-)

diff --git a/mupen64plus-core/src/device/r4300/new_dynarec/arm/arm_cpu_features.c b/mupen64plus-core/src/device/r4300/new_dynarec/arm/arm_cpu_features.c
index a3915a75..1428ef93 100644
--- a/mupen64plus-core/src/device/r4300/new_dynarec/arm/arm_cpu_features.c
+++ b/mupen64plus-core/src/device/r4300/new_dynarec/arm/arm_cpu_features.c
@@ -102,23 +102,20 @@ static unsigned short get_arm_cpu_part(void)
 
 void detect_arm_cpu_features(void)
 {
-    arm_cpu_features.SWP      = check_arm_cpu_feature("swp");
-    arm_cpu_features.Half     = check_arm_cpu_feature("half");
-    arm_cpu_features.Thumb    = check_arm_cpu_feature("thumb");
-    arm_cpu_features.FastMult = check_arm_cpu_feature("fastmult");
-    arm_cpu_features.VFP      = check_arm_cpu_feature("vfp");
-    arm_cpu_features.EDSP     = check_arm_cpu_feature("edsp");
-    arm_cpu_features.ThumbEE  = check_arm_cpu_feature("thumbee");
-    arm_cpu_features.NEON     = check_arm_cpu_feature("neon");
-    arm_cpu_features.VFPv3    = check_arm_cpu_feature("vfpv3");
-    arm_cpu_features.TLS      = check_arm_cpu_feature("tls");
-    arm_cpu_features.VFPv4    = check_arm_cpu_feature("vfpv4");
-    arm_cpu_features.IDIVa    = check_arm_cpu_feature("idiva");
-    arm_cpu_features.IDIVt    = check_arm_cpu_feature("idivt");
-
-    // Qualcomm Krait supports IDIVa but it doesn't report it. Check for krait.
-    if (get_arm_cpu_implementer() == 0x51 && get_arm_cpu_part() == 0x6F)
-        arm_cpu_features.IDIVa = arm_cpu_features.IDIVt = 1;
+    // detection fails on RG35XX_PLUS
+    arm_cpu_features.SWP      = 1;
+    arm_cpu_features.Half     = 1;
+    arm_cpu_features.Thumb    = 1;
+    arm_cpu_features.FastMult = 1;
+    arm_cpu_features.VFP      = 1;
+    arm_cpu_features.EDSP     = 1;
+    arm_cpu_features.ThumbEE  = 0;
+    arm_cpu_features.NEON     = 1;
+    arm_cpu_features.VFPv3    = 1;
+    arm_cpu_features.TLS      = 1;
+    arm_cpu_features.VFPv4    = 1;
+    arm_cpu_features.IDIVa    = 1;
+    arm_cpu_features.IDIVt    = 1;
 }
 
 void print_arm_cpu_features(void)